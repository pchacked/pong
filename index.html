<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: #fff;
            overflow: hidden;
        }

        #gameContainer {
            text-align: center;
        }

        canvas {
            border: 2px solid #333;
            display: block;
            margin: 0 auto;
        }

        #info {
            margin-top: 20px;
            font-size: 14px;
            color: #888;
        }

        #controls {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        #score {
            font-size: 48px;
            margin-bottom: 20px;
            letter-spacing: 20px;
        }

        .gamepad-status {
            margin-top: 10px;
            font-size: 12px;
            color: #4a4;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="score">0 - 0</div>
        <canvas id="pongCanvas"></canvas>
        <div id="info">Press SPACE to start</div>
        <div id="controls">
            Player 1: W/S or Gamepad 1 | Player 2: ↑/↓ or Gamepad 2
        </div>
        <div class="gamepad-status" id="gamepadStatus">No gamepads connected</div>
    </div>

    <script>
        const canvas = document.getElementById('pongCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const infoDisplay = document.getElementById('info');
        const gamepadStatus = document.getElementById('gamepadStatus');

        // Canvas setup
        canvas.width = 800;
        canvas.height = 600;

        // Game objects
        const paddleWidth = 10;
        const paddleHeight = 100;
        const ballSize = 10;

        let gameStarted = false;
        let gamePaused = false;

        const player1 = {
            x: 20,
            y: canvas.height / 2 - paddleHeight / 2,
            width: paddleWidth,
            height: paddleHeight,
            dy: 0,
            score: 0,
            speed: 6
        };

        const player2 = {
            x: canvas.width - 20 - paddleWidth,
            y: canvas.height / 2 - paddleHeight / 2,
            width: paddleWidth,
            height: paddleHeight,
            dy: 0,
            score: 0,
            speed: 6
        };

        const ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            size: ballSize,
            dx: 5,
            dy: 5,
            speed: 5
        };

        // Keyboard controls
        const keys = {};

        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ') {
                if (!gameStarted) {
                    gameStarted = true;
                    infoDisplay.textContent = 'Game On!';
                } else {
                    gamePaused = !gamePaused;
                    infoDisplay.textContent = gamePaused ? 'PAUSED' : 'Game On!';
                }
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Gamepad support
        let gamepads = {};

        window.addEventListener('gamepadconnected', (e) => {
            gamepads[e.gamepad.index] = e.gamepad;
            updateGamepadStatus();
        });

        window.addEventListener('gamepaddisconnected', (e) => {
            delete gamepads[e.gamepad.index];
            updateGamepadStatus();
        });

        function updateGamepadStatus() {
            const connectedGamepads = Object.keys(gamepads).length;
            if (connectedGamepads === 0) {
                gamepadStatus.textContent = 'No gamepads connected';
                gamepadStatus.style.color = '#666';
            } else if (connectedGamepads === 1) {
                gamepadStatus.textContent = '1 gamepad connected';
                gamepadStatus.style.color = '#4a4';
            } else {
                gamepadStatus.textContent = '2 gamepads connected';
                gamepadStatus.style.color = '#4f4';
            }
        }

        function getGamepadInput() {
            const gamepadList = navigator.getGamepads ? navigator.getGamepads() : [];
            
            // Player 1 - First gamepad
            if (gamepadList[0]) {
                const axes = gamepadList[0].axes;
                const buttons = gamepadList[0].buttons;
                
                // Left stick vertical axis or D-pad
                if (axes[1] < -0.3 || buttons[12]?.pressed) {
                    player1.dy = -player1.speed;
                } else if (axes[1] > 0.3 || buttons[13]?.pressed) {
                    player1.dy = player1.speed;
                } else {
                    if (!keys['w'] && !keys['s']) {
                        player1.dy = 0;
                    }
                }
            }

            // Player 2 - Second gamepad
            if (gamepadList[1]) {
                const axes = gamepadList[1].axes;
                const buttons = gamepadList[1].buttons;
                
                // Left stick vertical axis or D-pad
                if (axes[1] < -0.3 || buttons[12]?.pressed) {
                    player2.dy = -player2.speed;
                } else if (axes[1] > 0.3 || buttons[13]?.pressed) {
                    player2.dy = player2.speed;
                } else {
                    if (!keys['ArrowUp'] && !keys['ArrowDown']) {
                        player2.dy = 0;
                    }
                }
            }
        }

        function update() {
            if (!gameStarted || gamePaused) return;

            // Update gamepad input
            getGamepadInput();

            // Keyboard controls for Player 1
            if (keys['w'] || keys['W']) {
                player1.dy = -player1.speed;
            } else if (keys['s'] || keys['S']) {
                player1.dy = player1.speed;
            } else if (!navigator.getGamepads()[0]) {
                player1.dy = 0;
            }

            // Keyboard controls for Player 2
            if (keys['ArrowUp']) {
                player2.dy = -player2.speed;
            } else if (keys['ArrowDown']) {
                player2.dy = player2.speed;
            } else if (!navigator.getGamepads()[1]) {
                player2.dy = 0;
            }

            // Update paddle positions
            player1.y += player1.dy;
            player2.y += player2.dy;

            // Paddle boundaries
            player1.y = Math.max(0, Math.min(canvas.height - player1.height, player1.y));
            player2.y = Math.max(0, Math.min(canvas.height - player2.height, player2.y));

            // Update ball position
            ball.x += ball.dx;
            ball.y += ball.dy;

            // Ball collision with top/bottom walls
            if (ball.y <= 0 || ball.y + ball.size >= canvas.height) {
                ball.dy *= -1;
            }

            // Ball collision with paddles
            if (
                ball.x <= player1.x + player1.width &&
                ball.y + ball.size >= player1.y &&
                ball.y <= player1.y + player1.height
            ) {
                ball.dx = Math.abs(ball.dx);
                const hitPos = (ball.y - player1.y) / player1.height - 0.5;
                ball.dy = hitPos * 10;
            }

            if (
                ball.x + ball.size >= player2.x &&
                ball.y + ball.size >= player2.y &&
                ball.y <= player2.y + player2.height
            ) {
                ball.dx = -Math.abs(ball.dx);
                const hitPos = (ball.y - player2.y) / player2.height - 0.5;
                ball.dy = hitPos * 10;
            }

            // Score points
            if (ball.x < 0) {
                player2.score++;
                resetBall();
            } else if (ball.x > canvas.width) {
                player1.score++;
                resetBall();
            }

            updateScore();
        }

        function resetBall() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.dx = (Math.random() > 0.5 ? 1 : -1) * ball.speed;
            ball.dy = (Math.random() * 2 - 1) * ball.speed;
        }

        function updateScore() {
            scoreDisplay.textContent = `${player1.score} - ${player2.score}`;
        }

        function draw() {
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw center line
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 10]);
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw paddles
            ctx.fillStyle = '#fff';
            ctx.fillRect(player1.x, player1.y, player1.width, player1.height);
            ctx.fillRect(player2.x, player2.y, player2.width, player2.height);

            // Draw ball
            ctx.fillRect(ball.x, ball.y, ball.size, ball.size);
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Start game loop
        gameLoop();
    </script>
</body>
</html>